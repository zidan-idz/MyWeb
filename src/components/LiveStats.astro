---

---

<!-- Statistik (SQLite) -->
<div
    class="mt-6 pt-4 border-t border-dashed border-slate-200 dark:border-slate-800/50"
>
    <div class="flex items-center gap-4">
        <!-- Views (Baca Saja) -->
        <div
            class="flex items-center gap-2 text-xs font-mono text-slate-500"
            title="Total Views"
        >
            <i class="ri-eye-line text-[16px]"></i>
            <span id="view-count" class="animate-pulse">...</span>
        </div>

        <!-- Likes (Klik) -->
        <button
            id="like-btn"
            class="flex items-center gap-2 text-xs font-mono text-slate-500 hover:text-pink-500 transition-colors group focus:outline-none"
            title="Give a Like"
        >
            <i
                class="ri-thumb-up-line text-[16px] group-hover:scale-110 transition-transform"
            ></i>
            <span id="like-count">...</span>
        </button>
    </div>
</div>

<script is:inline>
    const viewCountEl = document.getElementById("view-count");
    const likeCountEl = document.getElementById("like-count");
    const likeBtn = document.getElementById("like-btn");

    // Format angka
    const formatNum = (num) => new Intl.NumberFormat("en-US").format(num);

    async function initStats() {
        try {
            // 1. Auto-register view
            const viewRes = await fetch("/api/stats", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "view" }),
            });
            const stats = await viewRes.json();
            updateUI(stats);
        } catch (e) {
            console.error("Stats error:", e);
        }
    }

    function updateUI(stats) {
        if (stats.views !== undefined) {
            viewCountEl.innerText = formatNum(stats.views);
            viewCountEl.classList.remove("animate-pulse");
        }
        if (stats.likes !== undefined)
            likeCountEl.innerText = formatNum(stats.likes);
    }

    // Logika Tombol Suka
    if (likeBtn) {
        likeBtn.addEventListener("click", async () => {
            // Update UI Optimis
            const currentLikes =
                parseInt(likeCountEl.innerText.replace(/,/g, "")) || 0;
            likeCountEl.innerText = formatNum(currentLikes + 1);
            likeBtn.classList.add("text-pink-500"); // Highlight instan

            try {
                const res = await fetch("/api/stats", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ type: "like" }),
                });
                const stats = await res.json();
                updateUI(stats); // Sinkronisasi server
            } catch (e) {
                console.error("Like error:", e);
            }
        });
    }

    // Jalankan saat dimuat
    initStats();
</script>
