---
import { DEV_CONFIG } from "../config/dev.config";
---

<!-- Loader -->
<div
    id="loader"
    data-dev-always-show={DEV_CONFIG.LOADER_ALWAYS_SHOW.toString()}
    class="fixed inset-0 z-[100] bg-slate-50 dark:bg-slate-950 flex items-center justify-center transition-opacity duration-700 ease-out"
>
    <span
        class="font-mono font-black text-4xl md:text-6xl text-slate-900 dark:text-slate-100 tracking-tighter"
    >
        Zidan<span class="text-indigo-500 animate-cursor-cycle"></span>IDz
    </span>
    <div class="absolute bottom-8 left-0 right-0 text-center">
        <p
            class="text-[10px] font-mono text-slate-400 dark:text-slate-600 uppercase tracking-widest"
        >
            &copy; {
                new Date().getFullYear() > 2024
                    ? `2024-${new Date().getFullYear()}`
                    : "2024"
            } Muhammad Raid Zaidani
        </p>
    </div>
</div>

<script is:inline>
    // Konfigurasi dari dev.config.js (diinjeksi via data attribute)
    const loader = document.getElementById("loader");
    const LOADER_COOLDOWN = 10 * 60 * 1000; // 10 Menit

    // Ambil config dari data attribute (fallback true untuk dev)
    const DEV_ALWAYS_SHOW = loader?.dataset.devAlwaysShow === "true";

    const lastShown = localStorage.getItem("last_loader_time");
    const now = Date.now();

    // Logika tampil?
    const shouldShow =
        DEV_ALWAYS_SHOW ||
        !lastShown ||
        now - parseInt(lastShown) > LOADER_COOLDOWN;

    window.addEventListener("load", () => {
        if (loader) {
            if (shouldShow) {
                // Update timestamp
                localStorage.setItem("last_loader_time", now.toString());

                // Fade out normal
                setTimeout(() => {
                    loader.style.opacity = "0";
                    loader.style.pointerEvents = "none";
                }, 1500); // 1.5 detik total
            } else {
                // Sembunyi instan (SKIP)
                loader.style.display = "none";
            }
        }
    });
</script>
